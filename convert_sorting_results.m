function lines = convert_sorting_results(kwikfile)
filename = strrep(fullfile(fileparts(kwikfile), '.phy', 'memcache', ...
    'phy.apps.kwik.gui.get_best_channels.pkl'), '\', '\\');
if isfile(filename)
    print_command(filename);
end

gid = 0;
while true
    filename = strrep(fullfile(fileparts(kwikfile), '.phy', num2str(gid), ...
        'memcache', 'phy.apps.kwik.gui.get_best_channels.pkl'), '\', '\\');
    if ~isfile(filename)
        break;
    end
    print_command(filename);
    gid = gid + 1;
end

lines = true;
end

function print_command(pklfile)
outname = strrep(pklfile, '.pkl', '.mat');
pyscript = strrep([ ...
    'import pickle;', ...
    'import sys;', ...
    'import scipy.io;', ...
    'import numpy as np;', ...
    'file = open("' pklfile '", "rb");', ...
    'dat = pickle.load(file);', ...
    'file.close();', ...
    'dat = dict(cluster_channel=np.array([[k[0], b[0]] for k, b in dat.items()]));', ...
    'scipy.io.savemat("' outname '", dat);', ...
    ], '"', "'");
fprintf('%s\n', sprintf('python -c "%s"', pyscript));
end